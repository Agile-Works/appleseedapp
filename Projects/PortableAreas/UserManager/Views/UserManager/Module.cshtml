@using Appleseed.Framework
@model UserManager.Models.UserManagerModel

  
@*<script type= "text/javascript" src="@HttpUrlBuilder.BuildUrl("~/aspnet_client/js/jquery-ui-1.7.custom.min.js")" ></script>
<script src="@HttpUrlBuilder.BuildUrl("~/aspnet_client/js/jquery.jqGrid.js")"></script>
<script src="@HttpUrlBuilder.BuildUrl("~/aspnet_client/UserManager/jquery-ui.min.js")"></script>*@

<head id="Head1" runat="server">
    <meta charset="utf-8">
    <title>User Manager</title>    
<link href="@HttpUrlBuilder.BuildUrl("~/aspnet_client/UserManager/jquery-ui.css")" rel="stylesheet" />
<link href="@HttpUrlBuilder.BuildUrl("~/aspnet_client/js/ui.jqgrid.css")" rel="stylesheet" />
<script src="@HttpUrlBuilder.BuildUrl("~/aspnet_client/jQuery/jquery-ui-1.9.2.min.js")"></script>
<script src="@HttpUrlBuilder.BuildUrl("~/aspnet_client/jQuery/grid.locale-en.js")"></script>
<script src="@HttpUrlBuilder.BuildUrl("~/aspnet_client/UserManager/jquery.jqGrid.min.js")"></script>
</head>  

<table id="list5">
</table> 
<div id="pager5"></div> 

<script type= "text/javascript">
    
    function Edit(url) {
        openInModal(url.toString(), '@General.GetString("EDIT_USER")');
        return false;
    }
    function Delete(id, userName) {
        if (confirm('@General.GetString("CONFIRM_DELETE_MESSAGE")' + userName+ '?')) {
            $.ajax({
                type: "POST",
                url: '@Url.Action("Delete")',
                data: {
                    "userID": id,
                },
                success: function (data) {
                    $('#list5').trigger('reloadGrid');
                },
            });
        }
        
        return true;

    }

    function search() {
        var textVal = jQuery("#textSearch").val();
        jQuery("#list5").jqGrid('setGridParam', {url: '@Url.Action("Search")?text=' + textVal, page: 1 });
        $("#list5").trigger("reloadGrid");
        
    }

    function myFunction() {
        var x = document.getElementById("textSearch");
        x.value = '@General.GetString("search")';
    }
    
    $(document).ready(function () {
    $("#list5").jqGrid({
        scroll: 1,
            colNames: ["UserName", "Email", "Rol", "", ""],
            colModel: [
                { name: 'UserName', index: 'UserName', sortable: false },
                { name: 'Email',    index: 'Email',    width: 300, sortable: false },
                { name: 'Rol',      index: 'Rol',      sortable: false },
                { name: 'Edit',     index: 'Edit',     width: 50, align: "center", formatter: formatterLink },
                { name: 'Delete',   index: 'Delete',   width: 50, align: "center", formatter: formatterDeleteLink },
            ],
            pager: "#pager5",
            sortname: 'UserName',
            rowNum: 15,
            rowList: [15, 30, 45],
            sortorder: "",
            url: '@Url.Action("GridUser")',
            datatype: "json",
            mtype: "POST",
            //rownumWidth: 6,
            gridview: true,
            width: '100%',
            height: "350",
            toolbar: [true, "top"],
            //jsonReader: { repeatitems: false, },
      viewrecords: true,
    }).navGrid("#pager5", { edit: false, add: false, del: false, search: false, refresh: false,  })
        .navButtonAdd("#pager5",
            {
                caption: '',
                buttonicon: "ui-icon ui-icon-refresh",
                onClickButton: function () {
                    jQuery("#list5").jqGrid('setGridParam', { url: '@Url.Action("GridUser")', page: 1 });
                    $("#list5").trigger("reloadGrid");
                },
            }
        )
        .navButtonAdd("#pager5",
            {
                caption: '@General.GetString("ADD_NEW_USER")',
                buttonicon: "ui-icon ui-icon-plus",
                onClickButton: function () {
                    openInModal("@Model.UserEmail", '@General.GetString("USER_REGISTRY")');
                    return false;
                },
                position: "first"
            }
        );
        
    var toolbarClone = $('#pager5_left').clone(true);
        // Assuming that your grid's ID is myGrid
    $('#t_list5').prepend(toolbarClone);

    function formatterLink(cellValue, options, rowObject) { 
        var result = "<a class='ui-icon ui-icon-pencil' href='#' onclick=\"Edit('" + rowObject.EditId + "');return false;\" style= \"color: blue; text-decoration: none;margin-left: 15px; \">" + cellValue + "</a>";
        return result;
    }
    function formatterDeleteLink(cellValue, options, rowObject) {
        var result = "<a class='ui-icon ui-icon-trash' onclick=\"Delete('" + rowObject.UserId + "', '" + rowObject.UserName + "')\" href=\"#\" style= \"color: blue; text-decoration: none; margin-left: 15px; \">" + cellValue + "</a>";
        return result;
    }

    $("#list5").setCaption(
        '<input type="search" onkeydown="if((13 == event.keyCode) || (13 == event.which)){ event.preventDefault(); search();}" name="item_code" id="textSearch" onfocus="this.value=null " value="' + '@General.GetString("search")' + '" onblur="myFunction()" />' +
        '<span style="vertical-align:middle; display:inline-block;" class="ui-icon ui-icon-search"></span>');
    });
    


</script>
